From aa7c9cf6d4291638cfdc95b1e89cb100ef7ffe51 Mon Sep 17 00:00:00 2001
From: Alcatraz323 <alcatraz32323@gmail.com>
Date: Wed, 8 Dec 2021 19:35:19 +0800
Subject: [PATCH 07/24] aura: RazerParts: enable refresh rate control

---
 RazerParts/res/values-zh-rCN/strings.xml              |  2 +-
 RazerParts/res/values/arrays.xml                      |  6 ++++++
 RazerParts/res/values/strings.xml                     |  2 +-
 RazerParts/res/xml/device_settings.xml                |  1 -
 .../src/com/razer/parts/DeviceSettingsFragment.java   | 11 -----------
 .../frameworks/base/core/res/res/values/config.xml    |  3 +++
 6 files changed, 11 insertions(+), 14 deletions(-)

diff --git a/RazerParts/res/values-zh-rCN/strings.xml b/RazerParts/res/values-zh-rCN/strings.xml
index c7c0702..21a8780 100755
--- a/RazerParts/res/values-zh-rCN/strings.xml
+++ b/RazerParts/res/values-zh-rCN/strings.xml
@@ -7,7 +7,7 @@
 
     <string name="category_display">显示</string>
     <string name="pref_resolution">分辨率(需要重新切换手势)</string>
-    <string name="pref_refresh_rate">刷新率(还不行)</string>
+    <string name="pref_refresh_rate">刷新率</string>
 
     <string name="category_chroma">Chroma MCU</string>
     <string name="pref_chroma">Chroma</string>
diff --git a/RazerParts/res/values/arrays.xml b/RazerParts/res/values/arrays.xml
index 73a6ccd..822e726 100755
--- a/RazerParts/res/values/arrays.xml
+++ b/RazerParts/res/values/arrays.xml
@@ -9,11 +9,17 @@
         <item>1440</item>
     </string-array>
     <string-array name="refresh_rate_entries">
+        <item>30Hz</item>
+        <item>48Hz</item>
+        <item>50Hz</item>
         <item>60Hz</item>
         <item>90Hz</item>
         <item>120Hz</item>
     </string-array>
     <string-array name="refresh_rate_values">
+        <item>30</item>
+        <item>48</item>
+        <item>50</item>
         <item>60</item>
         <item>90</item>
         <item>120</item>
diff --git a/RazerParts/res/values/strings.xml b/RazerParts/res/values/strings.xml
index 7944983..a677d6f 100755
--- a/RazerParts/res/values/strings.xml
+++ b/RazerParts/res/values/strings.xml
@@ -19,7 +19,7 @@
 
     <string name="category_display">Display</string>
     <string name="pref_resolution">Resolution (Require reconfigure gesture)</string>
-    <string name="pref_refresh_rate">Refresh Rate [WIP]</string>
+    <string name="pref_refresh_rate">Refresh Rate</string>
     <string name="pref_summary_place_holder"> </string>
 
     <string name="category_chroma">Chroma MCU</string>
diff --git a/RazerParts/res/xml/device_settings.xml b/RazerParts/res/xml/device_settings.xml
index 719c8b4..ec06a3c 100755
--- a/RazerParts/res/xml/device_settings.xml
+++ b/RazerParts/res/xml/device_settings.xml
@@ -27,7 +27,6 @@
             android:title="@string/pref_resolution" />
 
         <ListPreference
-            android:enabled="false"
             android:defaultValue="120"
             android:icon="@drawable/cellphone_screenshot"
             android:key="screen_refresh_rate"
diff --git a/RazerParts/src/com/razer/parts/DeviceSettingsFragment.java b/RazerParts/src/com/razer/parts/DeviceSettingsFragment.java
index f815b3e..f97a9b4 100755
--- a/RazerParts/src/com/razer/parts/DeviceSettingsFragment.java
+++ b/RazerParts/src/com/razer/parts/DeviceSettingsFragment.java
@@ -75,17 +75,6 @@ public class DeviceSettingsFragment extends PreferenceFragment implements Prefer
                 break;
             case SCREEN_REFRESH_RATE:
                 int parseInt = Integer.parseInt((String) o);
-                Log.e(TAG, "To set rate: "+parseInt);
-                // IWindowManager windowManagerService = WindowManagerGlobal.getWindowManagerService();
-                // if (windowManagerService == null) {
-                //     Log.e(TAG, "fps interface failure");
-                //     return false;
-                // }
-                // try {
-                //     windowManagerService.setDisplayRefreshRate(0, parseInt);
-                // } catch(RemoteException e) {
-                //     Log.e(TAG, "Error settings refresh rate", e);
-                // }
                 Settings.System.putInt(getContext().getContentResolver(), MIN_REFRESH_RATE, parseInt);
 	            Settings.System.putInt(getContext().getContentResolver(), PEAK_REFRESH_RATE, parseInt);
                 break;
diff --git a/overlay/frameworks/base/core/res/res/values/config.xml b/overlay/frameworks/base/core/res/res/values/config.xml
index a3cdba0..441cc40 100644
--- a/overlay/frameworks/base/core/res/res/values/config.xml
+++ b/overlay/frameworks/base/core/res/res/values/config.xml
@@ -914,6 +914,9 @@
     <!-- The default peak refresh rate. -->
     <integer name="config_defaultPeakRefreshRate">120</integer>
 
+    <!-- Set to true for built in fps ctl. -->
+    <bool name="config_show_smooth_display">true</bool>
+
     <!-- List of biometric sensors on the device, in decreasing strength. Consumed by AuthService
          when registering authenticators with BiometricService. Format must be ID:Modality:Strength,
          where: IDs are unique per device, Modality as defined in BiometricAuthenticator.java,
-- 
2.34.0

